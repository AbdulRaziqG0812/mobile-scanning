<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Billing List â€” Mobile Shop</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* âœ¨ Modern background with animation */
body { 
  font-family: "Segoe UI", Tahoma, sans-serif; 
  margin: 0; 
  padding: 20px; 
  color: #fff;
  background: linear-gradient(135deg, #1e3c72, #2a5298, #6c63ff);
  background-size: 400% 400%;
  animation: gradientShift 12s ease infinite;
}

/* Smooth animated gradient motion */
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Heading */
h1 { 
  text-align: center; 
  color: #ffcc00; 
  margin-bottom: 30px; 
  font-size: 34px; 
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  border-bottom: 3px solid #ffcc00;
  display: inline-block;
  padding-bottom: 8px;
  text-shadow: 0 0 10px rgba(0,0,0,0.5);
}

/* âœ¨ Glassmorphism Table Container */
.table-container {
  width: 100%;
  overflow-x: auto;
  border-radius: 15px;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  padding: 5px;
}

/* Table styling */
table { 
  width: 100%;
  min-width: 1200px;
  border-collapse: collapse; 
  background: transparent; 
}
th, td { 
  padding: 12px 14px; 
  text-align: center; 
  font-size: 14px; 
  border-bottom: 1px solid rgba(255,255,255,0.25);
  color: #fff;
}
th { 
  background: rgba(0,0,0,0.3);
  color: #ffcc00; 
  font-weight: 600; 
  text-transform: uppercase;
  font-size: 13px;
}
tr:hover { 
  background: rgba(255,255,255,0.1);
  transition: 0.2s;
}
tfoot td {
  border-top: 2px solid rgba(255,255,255,0.3);
  font-size: 15px;
  color: #ffcc00;
  text-shadow: 0 0 4px rgba(0,0,0,0.4);
}

/* Buttons */
.btn { 
  padding: 7px 12px; 
  border-radius: 8px; 
  color: white; 
  font-size: 13px; 
  text-decoration: none; 
  font-weight: 500;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: all 0.25s ease;
  border: none;
  cursor: pointer;
}
.btn-primary { background: linear-gradient(90deg, #007bff, #00aaff); }
.btn-danger { background: linear-gradient(90deg, #dc3545, #e55368); }
.btn-success { background: linear-gradient(90deg, #28a745, #34ce57); }
.btn-back { background: linear-gradient(90deg, #17a2b8, #20c997); }
.btn-filter { background: linear-gradient(90deg, #6c63ff, #857fff); }

.btn:hover { 
  transform: translateY(-2px); 
  box-shadow: 0 3px 10px rgba(0,0,0,0.3); 
}

/* Alerts */
.alert { 
  padding: 12px 15px; 
  margin: 15px auto; 
  width: 95%; 
  border-radius: 8px; 
  font-weight: 500; 
  text-align: center; 
  color: #fff;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(8px);
  box-shadow: 0 3px 6px rgba(0,0,0,0.2); 
}

/* Top actions area */
.top-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  flex-wrap: wrap;
  gap: 12px;
}

/* âœ¨ Glass search box */
.search-box form {
  display: flex;
  gap: 10px;
  align-items: center;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.search-box input {
  padding: 8px 12px;
  border: none;
  border-radius: 6px;
  background: rgba(255,255,255,0.9);
  font-size: 14px;
  color: #333;
  min-width: 220px;
}
.search-box input:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(108,99,255,0.25);
}

.action-buttons { display: flex; gap: 10px; flex-wrap: wrap; }

/* Pagination */
#pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
  margin-top: 20px;
}
.page-btn {
  background: linear-gradient(90deg, #007bff, #00aaff);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s;
}
.page-btn:hover { background: #0056b3; }
.page-btn.active {
  background: #28a745;
  font-weight: bold;
  transform: scale(1.05);
}
.page-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* âœ… Keep each bill on one line */
td {
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}
td:nth-child(6), td:nth-child(7), td:nth-child(8) {
  max-width: 250px;
  white-space: normal;
  word-wrap: break-word;
}
</style>
</head>
<body>

<div style="text-align:center;">
  <h1>ðŸ§¾ Billing List</h1>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
  {% for category, message in messages %}
    <div class="alert"><i class="fa-solid fa-info-circle"></i> {{ message }}</div>
  {% endfor %}
{% endif %}
{% endwith %}

<!-- Top Actions -->
<div class="top-actions">
  <div class="search-box">
    <form method="GET" action="{{ url_for('search_bill') }}">
      <input type="text" name="q" placeholder="Search by Model, IMEI or Serial..." value="{{ keyword }}">
      <button type="submit" class="btn btn-filter"><i class="fa-solid fa-magnifying-glass"></i> Search</button>
    </form>
  </div>

  <div class="action-buttons">
    <a href="{{ url_for('billing') }}" class="btn btn-success"><i class="fa-solid fa-plus"></i> Add Bill</a>
    <a href="{{ url_for('dashboard') }}" class="btn btn-back"><i class="fa-solid fa-house"></i> Home</a>
  </div>
</div>

<!-- Billing Table -->
<div class="table-container">
  <table class="paginated-table">
    <thead>
      <tr>
        <th>Bill ID</th>
        <th>Bill Date</th>
        <th>Customer Name</th>
        <th>Mobile</th>
        <th>Contact</th>
        <th>IMEI</th>
        <th>Serial</th>
        <th>Purchase Price</th>
        <th>Subtotal</th>
        <th>Discount</th>
        <th>Net Total</th>
        <th>Actions</th>
      </tr>
    </thead>

    <!-- âœ… Corrected Tbody -->
    <tbody>
      {% for bill in bills %}
        <tr>
          <td>{{ bill.bill_id }}</td>
          <td>{{ bill.bill_date.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>{{ bill.customer_name }}</td>
          <td>{{ bill.customer_mobile }}</td>
          <td>{{ bill.customer_contact }}</td>
          <td>
            {% for item in bill_items[bill.bill_id] %}
              {{ item.product_imei }}{% if not loop.last %}, {% endif %}
            {% endfor %}
          </td>
          <td>
            {% for item in bill_items[bill.bill_id] %}
              {{ item.product_serial }}{% if not loop.last %}, {% endif %}
            {% endfor %}
          </td>
          <td>
            {% for item in bill_items[bill.bill_id] %}
              {{ "%.2f"|format(item.purchase_price or 0) }}{% if not loop.last %}, {% endif %}
            {% endfor %}
          </td>
          <td>{{ "%.2f"|format(bill.subtotal) }}</td>
          <td>{{ "%.2f"|format(bill.discount) }}</td>
          <td>{{ "%.2f"|format(bill.net_total) }}</td>
          <td>
            <a href="{{ url_for('invoice', bill_id=bill.bill_id) }}" class="btn btn-primary" title="View"><i class="fa fa-eye"></i></a>
            <a href="{{ url_for('delete_bill', bill_id=bill.bill_id) }}" class="btn btn-danger" title="Delete" onclick="return confirm('Are you sure?')"><i class="fa fa-trash"></i></a>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="12" style="padding:18px;color:#fff;">No bills found.</td>
        </tr>
      {% endfor %}
    </tbody>

    <tfoot>
      <tr style="background: rgba(0, 0, 0, 0.3); font-weight: 600; color: #ffcc00;">
        <td colspan="8" style="text-align:right; padding: 12px 14px;">Total Summary:</td>
        <td style="text-align:right;">OMR {{ "%.2f"|format(sub_total) }}</td>
        <td></td>
        <td style="text-align:right;">OMR {{ "%.2f"|format(net_total) }}</td>
        <td></td>
      </tr>
    </tfoot>

  </table>
</div>

<div id="pagination"></div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const rowsPerPage = 10;
  const table = document.querySelector(".paginated-table");
  const tbody = table.querySelector("tbody");
  const rows = Array.from(tbody.querySelectorAll("tr"));
  const totalRows = rows.length;
  const pagination = document.getElementById("pagination");

  const totalPages = Math.ceil(totalRows / rowsPerPage);
  let currentPage = 1;

  function displayPage(page) {
    currentPage = page;
    const start = (page - 1) * rowsPerPage;
    const end = start + rowsPerPage;

    rows.forEach((row, index) => {
      row.style.display = (index >= start && index < end) ? "" : "none";
    });

    updatePagination();
  }

  function updatePagination() {
    pagination.innerHTML = "";

    const prevBtn = document.createElement("button");
    prevBtn.innerHTML = "Â«";
    prevBtn.disabled = currentPage === 1;
    prevBtn.className = "page-btn";
    prevBtn.onclick = () => displayPage(currentPage - 1);
    pagination.appendChild(prevBtn);

    const pageBlock = document.createElement("button");
    pageBlock.innerHTML = currentPage;
    pageBlock.className = "page-btn active";
    pagination.appendChild(pageBlock);

    const nextBtn = document.createElement("button");
    nextBtn.innerHTML = "Â»";
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.className = "page-btn";
    nextBtn.onclick = () => displayPage(currentPage + 1);
    pagination.appendChild(nextBtn);
  }

  displayPage(1);
});

// Auto-hide flash messages after 3 seconds
document.addEventListener("DOMContentLoaded", () => {
  const alerts = document.querySelectorAll('.alert');
  alerts.forEach(alert => setTimeout(() => alert.remove(), 3000));
});
</script>

</body>
</html>
