<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reports - Sales Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  /* üåà Background & Base Styling */
  body {
    font-family: 'Poppins', 'Segoe UI', sans-serif;
    margin: 0;
    padding: 40px 20px;
    background: linear-gradient(135deg, #004aad 0%, #00c6ff 100%);
    background-attachment: fixed;
    color: #333;
  }

  h2 {
    text-align: center;
    color: #fff;
    font-size: 2.2rem;
    letter-spacing: 1px;
    text-shadow: 0 4px 15px rgba(0,0,0,0.2);
    margin-bottom: 40px;
  }

  /* üîç Form */
  form {
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 35px;
  }
  input[type="month"] {
    padding: 12px 15px;
    border-radius: 10px;
    border: none;
    outline: none;
    font-size: 15px;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  }
  button {
    padding: 12px 20px;
    border-radius: 10px;
    border: none;
    background: linear-gradient(135deg, #ff7b00, #ffb700);
    color: #fff;
    font-size: 15px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    transition: 0.3s;
  }
  button:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  }

  /* üí° Summary Cards */
  .summary {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 25px;
    margin-bottom: 40px;
  }
  .card {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 16px;
    padding: 25px;
    flex: 1 1 200px;
    text-align: center;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    transition: 0.3s;
    color: #fff;
  }
  .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  .card h3 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 12px;
    opacity: 0.9;
  }
  .card p {
    font-size: 22px;
    font-weight: 700;
    margin: 0;
  }

  /* üìä Charts */
  .charts {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
    gap: 30px;
    margin-top: 40px;
  }

  /* üëá Chart container (compact size) */
  .chart-box {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    height: 320px;
  }

  canvas {
    width: 100% !important;
    height: 100% !important;
  }
</style>
</head>
<body>

<h2>üìä Sales Dashboard Report</h2>

<form method="POST" action="/reports">
  <input type="month" name="month" value="{{ selected_month or '' }}">
  <button type="submit"><i class="fa fa-search"></i> Show Report</button>
</form>

<!-- üíé Summary Cards -->
<div class="summary">
  <div class="card"><h3>üí∞ Total Sales</h3><p>{{ "%.2f"|format(total_sales or 0) }}</p></div>
  <div class="card"><h3>üõí Total Purchase</h3><p>{{ "%.2f"|format(total_purchase or 0) }}</p></div>
  <div class="card"><h3>üìà Total Profit</h3><p>{{ "%.2f"|format(total_profit or 0) }}</p></div>
  <div class="card"><h3>üì¶ Mobile Sold</h3><p>{{ total_units or 0 }}</p></div>
</div>

<!-- üìà Charts -->
<div class="charts">
  <div class="chart-box"><canvas id="salesPurchaseChart"></canvas></div>
  <div class="chart-box"><canvas id="profitChart"></canvas></div>
  <div class="chart-box"><canvas id="unitsChart"></canvas></div>
  <div class="chart-box"><canvas id="profitPieChart"></canvas></div>
</div>

<script>
const labels = {{ chart_labels|tojson }};
const sales = {{ sales_data|tojson }};
const purchase = {{ purchase_data|tojson }};
const profit = {{ profit_data|tojson }};
const units = {{ units_data|tojson }};

// üíπ Sales vs Purchase (Vertical Bar)
new Chart(document.getElementById('salesPurchaseChart').getContext('2d'), {
  type: 'bar',
  data: {
    labels,
    datasets: [
      { label: 'Sales', data: sales, backgroundColor: '#007bff', borderRadius: 6 },
      { label: 'Purchase', data: purchase, backgroundColor: '#ff9800', borderRadius: 6 }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { 
      title: { display: true, text: 'Sales vs Purchase', color: '#fff', font: { size: 15 } }, 
      legend: { labels: { color: '#fff' } } 
    },
    scales: { x: { ticks: { color: '#fff' } }, y: { ticks: { color: '#fff' } } }
  }
});

// üí∞ Profit Trend (Horizontal Bar)
new Chart(document.getElementById('profitChart').getContext('2d'), {
  type: 'bar',
  data: { 
    labels, 
    datasets: [{ label: 'Profit', data: profit, backgroundColor: '#00e676', borderRadius: 6 }] 
  },
  options: {
    indexAxis: 'y',
    responsive: true,
    maintainAspectRatio: false,
    plugins: { title: { display: true, text: 'Profit Trend', color: '#fff', font: { size: 15 } }, legend: { labels: { color: '#fff' } } },
    scales: { x: { ticks: { color: '#fff' } }, y: { ticks: { color: '#fff' } } }
  }
});

// üì¶ Units Sold (Doughnut Chart)
new Chart(document.getElementById('unitsChart').getContext('2d'), {
  type: 'doughnut',
  data: { 
    labels,
    datasets: [{ 
      label: 'Mobile Sold', 
      data: units, 
      backgroundColor: [
        '#ffb300', // Amber
        '#00e676', // Green
        '#ff5252', // Red
        '#7c4dff', // Deep Purple
        '#29b6f6', // Light Blue
        '#ff4081', // Pink
        '#c6ff00'  // Lime
      ],
      borderColor: '#fff',
      borderWidth: 2
    }] 
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { 
      title: { display: true, text: 'Mobile Sold Distribution', color: '#fff', font: { size: 15 } },
      legend: { labels: { color: '#fff' } }
    }
  }
});

// ü•ß Profit vs Purchase (Pie Chart)
new Chart(document.getElementById('profitPieChart').getContext('2d'), {
  type: 'pie',
  data: { 
    labels: ['Profit', 'Purchase'], 
    datasets: [{ 
      data: [{{ total_profit|tojson or 0 }}, {{ total_purchase|tojson or 0 }}], 
      backgroundColor: ['#00e676', '#ff9800'] 
    }] 
  },
  options: { 
    responsive: true, 
    maintainAspectRatio: false,
    plugins: { 
      title: { display: true, text: 'Overall Profit vs Purchase', color: '#fff', font: { size: 15 } }, 
      legend: { labels: { color: '#fff' } } 
    } 
  }
});
</script>

</body>
</html>
